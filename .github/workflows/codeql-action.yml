name: 'PR Check - Packaging: Download using registries'
env:
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
on:
  push:
    branches:
    - main
  pull_request:
    types:
    - opened
    - synchronize
    - reopened
    - ready_for_review
    branches:
    - main
  workflow_dispatch: {}

jobs:
  codeql:
    runs-on: ubuntu-latest
    steps:
    - name: Check out repository
      uses: actions/checkout@v3
  
    - name: Init with registries-auth-tokens
      uses: github/codeql-action/init@aeisenberg/ghes-pack-download
      with:
        tools: https://github.com/dsp-testing/codeql-cli-nightlies/releases/download/untagged-e22a3e4c9af290cbc8e5/codeql.zip
        config-file: ./.github/codeql/codeql-config-registries.yml
        languages: javascript
        registries-auth-tokens: https://ghcr.io/v2/=${{ secrets.GHES_TOKEN }}
      env:
        TEST_MODE: true
